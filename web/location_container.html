<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <element name="location-container">
      <template>
        <div>
          <template instantiate="if locations.length > 0">
            <ul id="location-list">
              <template iterate="location in locations" >
                <li>{{location.name}}</li>
              </template>
            </ul>        
          </template>
          <template instantiate="if empty">
            <p>No locations found</p>      
          </template>
        </div>
      </template>
      <script type="application/dart">
        import 'dart:async';
        import 'package:web_ui/web_ui.dart';
        import 'package:dart_prototype/dart_prototype_library.dart';
   
        class LocationContainer extends WebComponent {
          
          @observable
          WebService locationService;
  
          @observable
          final ObservableList<Location> locations = new ObservableList<Location>();
       
          LocationContainer() {  
          }      
      
          void inserted() {
            refreshLocations();
            Duration duration = new Duration(seconds: 5);
            new Timer(duration, () => setupAutoUpdate());
          }
      
          void refreshLocations() {
            locationService.call("/locations").then((response) {
                locations.clear();
                locations.addAll(response);
                print(locations.length);
            });
          }
          
          void setupAutoUpdate() {
            refreshLocations();
            
            Duration duration = new Duration(seconds: 2);
            new Timer(duration, () => setupAutoUpdate());
          }
          
          @observable
          bool get empty {
            return locations.length == 0;
          }
        }        
      </script>
    </element>
  </body>
</html>
